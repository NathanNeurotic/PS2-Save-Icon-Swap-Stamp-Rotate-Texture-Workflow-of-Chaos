<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>PS2 IconSys Library: GB2D/include/gb2d.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.4 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul>
</div>
<h1>GB2D/include/gb2d.h</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*------------------------------------*</span>
<a name="l00002"></a>00002 <span class="comment"> * ghulbus2D                          *</span>
<a name="l00003"></a>00003 <span class="comment"> *  A 2D graphics framework           *</span>
<a name="l00004"></a>00004 <span class="comment"> *-----------------------------V-1.1--*/</span>
<a name="l00005"></a>00005 <span class="comment">/***********************************************+</span>
<a name="l00006"></a>00006 <span class="comment">| Optional modules:                             |</span>
<a name="l00007"></a>00007 <span class="comment">|  - GB2D__USE_GBUI   (requires DXUT)           |</span>
<a name="l00008"></a>00008 <span class="comment">|  - GB2D__USE_GBTEXT (requires DXUT)           |</span>
<a name="l00009"></a>00009 <span class="comment">|                                               |</span>
<a name="l00010"></a>00010 <span class="comment">| (flags for modules have to be set in          |</span>
<a name="l00011"></a>00011 <span class="comment">|   the build environment!)                     |</span>
<a name="l00012"></a>00012 <span class="comment">+***********************************************/</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="preprocessor">#ifndef _WINDOWS_</span>
<a name="l00015"></a>00015 <span class="preprocessor"></span><span class="preprocessor">#include "windows.h"</span>
<a name="l00016"></a>00016 <span class="preprocessor">#endif</span>
<a name="l00017"></a>00017 <span class="preprocessor"></span><span class="preprocessor">#ifndef _D3D9_H_</span>
<a name="l00018"></a>00018 <span class="preprocessor"></span><span class="preprocessor">#include "d3d9.h"</span>
<a name="l00019"></a>00019 <span class="preprocessor">#endif</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span><span class="preprocessor">#ifndef __D3DX9_H__</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span><span class="preprocessor">#include "d3dx9.h"</span>
<a name="l00022"></a>00022 <span class="preprocessor">#endif</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span><span class="preprocessor">#ifndef _VECTOR_</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span><span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#endif</span>
<a name="l00026"></a>00026 <span class="preprocessor"></span><span class="preprocessor">#ifndef _GHULBUS2D_</span>
<a name="l00027"></a>00027 <span class="preprocessor"></span><span class="preprocessor">#define _GHULBUS2D_</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span>  <span class="comment">//TYPEDEFS:</span>
<a name="l00029"></a>00029   <span class="keyword">class </span>gb2DManager;                <span class="comment">//Main engine object</span>
<a name="l00030"></a>00030   <span class="keyword">class </span>gb2DSprite;                 <span class="comment">//Used for storing sprite-data</span>
<a name="l00031"></a>00031   <span class="keyword">class </span>gb2DImageLoader;            <span class="comment">//Used for loading TGA image files</span>
<a name="l00032"></a>00032   <span class="keyword">class </span>gb2DFont;                   <span class="comment">//Used for dx3d-based text-output</span>
<a name="l00033"></a>00033   <span class="keyword">typedef</span> gb2DManager *LPGB2D;
<a name="l00034"></a>00034   <span class="keyword">typedef</span> gb2DSprite  *LPGBSPRITE;
<a name="l00035"></a>00035   <span class="keyword">typedef</span> gb2DFont    *LPGBFONT;
<a name="l00036"></a>00036 <span class="preprocessor"># ifdef GB2D__USE_GBTEXT</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span>      <span class="keyword">class </span>gb2DText;                   <span class="comment">//custom textengine</span>
<a name="l00038"></a>00038       <span class="keyword">typedef</span> gb2DText    *LPGBTEXT;
<a name="l00039"></a>00039 <span class="preprocessor"># else</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span>      <span class="keyword">typedef</span> <span class="keywordtype">void</span>        *LPGBTEXT;
<a name="l00041"></a>00041 <span class="preprocessor"># endif</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span><span class="preprocessor">#  ifdef GB2D__USE_GBUI</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span>      <span class="keyword">class </span>gbUIManager;
<a name="l00044"></a>00044       <span class="keyword">typedef</span> gbUIManager *LPGBUI;
<a name="l00045"></a>00045 <span class="preprocessor">#  else</span>
<a name="l00046"></a>00046 <span class="preprocessor"></span>      <span class="keyword">typedef</span> <span class="keywordtype">void</span>        *LPGBUI;
<a name="l00047"></a>00047 <span class="preprocessor">#  endif</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span>
<a name="l00049"></a>00049 
<a name="l00050"></a>00050   <span class="keyword">enum</span> GB2DERROR {              <span class="comment">//describes the errorstate of any GB2D-object</span>
<a name="l00051"></a>00051     GB2D_OK,                        <span class="comment">//No errors</span>
<a name="l00052"></a>00052     GB2D_FAILED,                    <span class="comment">//General failure, check hres for further detail</span>
<a name="l00053"></a>00053     GB2D_OUTOFMEMORY,               <span class="comment">//memory allocation failed</span>
<a name="l00054"></a>00054     GB2D_NOTIMPLEMENTED,            <span class="comment">//indicates that a requested feature is not yet implemented</span>
<a name="l00055"></a>00055     GB2D_D3DCREATEFAILED,           <span class="comment">//Failure while calling Direct3DCreate9()</span>
<a name="l00056"></a>00056     GB2D_D3DCREATEDEVICEFAILED,     <span class="comment">//Failure while calling IDirect3D9::CreateDevice()</span>
<a name="l00057"></a>00057     GB2D_D3DCREATETEXTUREFAILED,    <span class="comment">//Failure while calling IDirect3DDevice9::CreateTexture() e.g. while initializing framebuffer</span>
<a name="l00058"></a>00058     GB2D_D3DCREATESPRITEFAILED,     <span class="comment">//Failure while calling D3DXCreateSprite() e.g. while initializing framebuffer</span>
<a name="l00059"></a>00059     GB2D_D3DCREATEFONTFAILED,       <span class="comment">//Failure while calling D3DXCreateFont()</span>
<a name="l00060"></a>00060     GB2D_RENDEROUTOFBOUNDARIES,     <span class="comment">//tried to render to an area out of buffer</span>
<a name="l00061"></a>00061     GB2D_FILEOPENFAILED,            <span class="comment">//a file could not be opened (doesn't exist?)</span>
<a name="l00062"></a>00062     GB2D_FILEREADERROR,             <span class="comment">//reading from a file failed</span>
<a name="l00063"></a>00063     GB2D_DEVICEACCESSFAILED,        <span class="comment">//usually triggered when trying to render to an unlocked buffer</span>
<a name="l00064"></a>00064     GB2D_ENUMERATIONFAILED,         <span class="comment">//an error occured while enumerating</span>
<a name="l00065"></a>00065     GB2D_ILLEGALPARAMETER,          <span class="comment">//one ore more specified parameters are invalid</span>
<a name="l00066"></a>00066     GB2D_NOTACTIVATED,              <span class="comment">//tried to use a feature that was disabled via preprocessor flag</span>
<a name="l00067"></a>00067   };
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 
<a name="l00070"></a>00070   <span class="comment">//GLOBALS:</span>
<a name="l00071"></a>00071   <span class="keyword">const</span> <span class="keywordtype">wchar_t</span>* TranslateErrorStateW(GB2DERROR);
<a name="l00072"></a>00072   <span class="keyword">const</span> <span class="keywordtype">char</span>* TranslateErrorStateA(GB2DERROR);
<a name="l00073"></a>00073 <span class="preprocessor"># ifdef UNICODE</span>
<a name="l00074"></a>00074 <span class="preprocessor"></span><span class="preprocessor">#   define TranslateErrorState TranslateErrorStateW </span>
<a name="l00075"></a>00075 <span class="preprocessor"></span><span class="preprocessor"># else</span>
<a name="l00076"></a>00076 <span class="preprocessor"></span><span class="preprocessor">#   define TranslateErrorState TranslateErrorStateA</span>
<a name="l00077"></a>00077 <span class="preprocessor"></span><span class="preprocessor"># endif</span>
<a name="l00078"></a>00078 <span class="preprocessor"></span>
<a name="l00079"></a>00079   LPGB2D CreateGB2D(HWND);      <span class="comment">//Creates a gb2DManager-object</span>
<a name="l00080"></a>00080   LPGB2D CreateGB2D(HWND hWnd, <span class="keywordtype">int</span> resX, <span class="keywordtype">int</span> resY, <span class="keywordtype">bool</span> fullscreen=<span class="keyword">false</span>);
<a name="l00081"></a>00081   LPGB2D CreateGB2DExternal(HWND hWnd, LPDIRECT3DDEVICE9 dev, <span class="keywordtype">int</span> resX, <span class="keywordtype">int</span> resY, <span class="keywordtype">bool</span> fullscreen);
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 
<a name="l00084"></a>00084   <span class="comment">//CLASSES:</span>
<a name="l00085"></a>00085   <span class="keyword">class </span>gb2DInterface {                     <span class="comment">//Interface Class (abstract)</span>
<a name="l00086"></a>00086   <span class="keyword">protected</span>:
<a name="l00087"></a>00087       GB2DERROR errorstate;                 <span class="comment">//global errorstate; check hres if this is != GB2D_OK</span>
<a name="l00088"></a>00088   <span class="keyword">public</span>:
<a name="l00089"></a>00089       gb2DInterface(): errorstate(GB2D_OK) {}
<a name="l00090"></a>00090       <span class="keyword">virtual</span> GB2DERROR GetErrorState()=0;  <span class="comment">//Return and clear the current errorstate of the object</span>
<a name="l00091"></a>00091   };
<a name="l00092"></a>00092 
<a name="l00093"></a>00093 
<a name="l00094"></a>00094   <span class="keyword">class </span>gb2DFontList {  <span class="comment">//TODO</span>
<a name="l00095"></a>00095       <span class="keyword">friend</span> gb2DManager;
<a name="l00096"></a>00096   <span class="keyword">private</span>:
<a name="l00097"></a>00097       std::vector&lt;LPGBFONT&gt; v;
<a name="l00098"></a>00098       <span class="keywordtype">void</span> Render();
<a name="l00099"></a>00099       <span class="keywordtype">void</span> AddFont(LPGBFONT font);
<a name="l00100"></a>00100       <span class="keywordtype">void</span> RemoveFont(LPGBFONT font);
<a name="l00101"></a>00101   <span class="keyword">public</span>:
<a name="l00102"></a>00102       gb2DFontList();
<a name="l00103"></a>00103       ~gb2DFontList();
<a name="l00104"></a>00104   };
<a name="l00105"></a>00105 
<a name="l00106"></a>00106 
<a name="l00107"></a>00107   <span class="keyword">class </span>gb2DManager: <span class="keyword">public</span> gb2DInterface {
<a name="l00108"></a>00108   <span class="keyword">private</span>:
<a name="l00109"></a>00109     LPDIRECT3D9              lpD3D;             <span class="comment">//D3D main object</span>
<a name="l00110"></a>00110     LPDIRECT3DDEVICE9        lpDev;             <span class="comment">//D3D device</span>
<a name="l00111"></a>00111     LPDIRECT3DTEXTURE9       lpBuffer;          <span class="comment">//Texture holding buffer</span>
<a name="l00112"></a>00112     LPD3DXSPRITE             lpBufferSprite;    <span class="comment">//Sprite used for rendering buffer</span>
<a name="l00113"></a>00113     D3DLOCKED_RECT           rct;               <span class="comment">//used for direct buffer manipulation</span>
<a name="l00114"></a>00114     D3DPRESENT_PARAMETERS    d3dpp;             <span class="comment">//d3dpp</span>
<a name="l00115"></a>00115     HRESULT                  hres;              <span class="comment">//global result handle, may be used for detailed debugging</span>
<a name="l00116"></a>00116     HWND                     hWnd;              <span class="comment">//hWnd</span>
<a name="l00117"></a>00117     HINSTANCE                hInst;             <span class="comment">//hInst (required for DInput)</span>
<a name="l00118"></a>00118     D3DCOLOR                 d3dClearColor;     <span class="comment">//color used for framebuffer-clearing</span>
<a name="l00119"></a>00119     <span class="keywordtype">bool</span>                     rendering;         <span class="comment">//global rendering flag</span>
<a name="l00120"></a>00120     <span class="keywordtype">bool</span>                     locked;            <span class="comment">//flags if the framebuffer is locked for rendering</span>
<a name="l00121"></a>00121     <span class="keywordtype">int</span>                      scrWidth;          <span class="comment">//X-resolution of engine viewport</span>
<a name="l00122"></a>00122     <span class="keywordtype">int</span>                      scrHeight;         <span class="comment">//Y-resolution of engine viewport</span>
<a name="l00123"></a>00123     <span class="keywordtype">bool</span>                     scrWindowed;       <span class="comment">//indicates whether GB2D runs windowed or fullscreen</span>
<a name="l00124"></a>00124     gb2DFontList             fontList;          <span class="comment">//stores all fonts created by the engine</span>
<a name="l00125"></a>00125     ::std::vector&lt;LPGBTEXT&gt;  textList;          <span class="comment">//stores all texts created by the engine</span>
<a name="l00126"></a>00126     ::std::vector&lt;LPGBUI&gt;    uiList;            <span class="comment">//stores all ui manager objects created by the engine</span>
<a name="l00127"></a>00127   <span class="keyword">public</span>:
<a name="l00128"></a>00128     gb2DManager(HWND hWnd, <span class="keywordtype">int</span> resX, <span class="keywordtype">int</span> resY, <span class="keywordtype">bool</span> fullscreen);
<a name="l00129"></a>00129                                 <span class="comment">//Initializes Direct3D and Manager-objects</span>
<a name="l00130"></a>00130     gb2DManager(LPDIRECT3DDEVICE9 devive, HWND hWnd, <span class="keywordtype">int</span> resX, <span class="keywordtype">int</span> resY, <span class="keywordtype">bool</span> fullscreen);
<a name="l00131"></a>00131                                 <span class="comment">//starts gb2D on top of an already initialized device</span>
<a name="l00132"></a>00132     ~gb2DManager();             <span class="comment">//Releases all Direct3D-objects and deletes dynamic data</span>
<a name="l00133"></a>00133     GB2DERROR GetErrorState();  <span class="comment">//Return the current errorstate of the manager</span>
<a name="l00134"></a>00134     HRESULT GetHRes();          <span class="comment">//Return the global result handle</span>
<a name="l00135"></a>00135     LPGBFONT CreateConsoleFont(<span class="keywordtype">int</span> fontSize, <span class="keywordtype">int</span> fontBold, <span class="keywordtype">int</span> fontItalic, <span class="keyword">const</span> <span class="keywordtype">wchar_t</span>* fontName);
<a name="l00136"></a>00136     LPGBTEXT CreateText();
<a name="l00137"></a>00137     LPGBUI CreateUIManager();
<a name="l00138"></a>00138     <span class="keywordtype">void</span> BeginScene();          <span class="comment">//Open framebuffer for rendering</span>
<a name="l00139"></a>00139     <span class="keywordtype">void</span> EndScene();            <span class="comment">//Unlock framebuffer</span>
<a name="l00140"></a>00140     <span class="keywordtype">void</span> Render();              <span class="comment">//Opens D3D-device for drawing; sets global rendering flag</span>
<a name="l00141"></a>00141     <span class="keywordtype">void</span> Flip();                <span class="comment">//Renders framebuffer and fonts, closes the D3D-device and presents the backbuffer; clears global rendering flag</span>
<a name="l00142"></a>00142     <span class="keywordtype">void</span> SetClearColor(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>);
<a name="l00143"></a>00143                                 <span class="comment">//Select the Clear color used for Backbuffer clear</span>
<a name="l00144"></a>00144     <span class="keywordtype">void</span> PutPixel(<span class="keywordtype">int</span>, <span class="keywordtype">int</span>, D3DCOLOR);
<a name="l00145"></a>00145                                 <span class="comment">//Set a single pixel in the framebuffer (slow!)</span>
<a name="l00146"></a>00146     <span class="keywordtype">bool</span> IsRendering();         <span class="comment">//Returns status of the global rendering flag</span>
<a name="l00147"></a>00147     <span class="keywordtype">bool</span> IsLocked();            <span class="comment">//Returns true if called between BeginScene() and EndScene()</span>
<a name="l00148"></a>00148     <span class="keywordtype">void</span> ClrScr();              <span class="comment">//Clear the framebuffer with black</span>
<a name="l00149"></a>00149     <span class="keywordtype">void</span> Blt(DWORD* data, <span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height, <span class="keywordtype">int</span> posX, <span class="keywordtype">int</span> posY);
<a name="l00150"></a>00150                                 <span class="comment">//Use for blitting 32 bit image data</span>
<a name="l00151"></a>00151     <span class="keywordtype">void</span> Blt(LPGBSPRITE sprite);<span class="comment">//Use for blitting Sprite</span>
<a name="l00152"></a>00152     <span class="keywordtype">void</span> BltRotate(LPGBSPRITE sprite, <span class="keywordtype">double</span> angle);
<a name="l00153"></a>00153                                 <span class="comment">//Use for blitting rotated Sprite</span>
<a name="l00154"></a>00154     <span class="keywordtype">void</span> Blt24(DWORD* data, <span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height, <span class="keywordtype">int</span> posX, <span class="keywordtype">int</span> posY);
<a name="l00155"></a>00155                                 <span class="comment">//Use for non-alpha blitting of 32 bit image data</span>
<a name="l00156"></a>00156     <span class="keywordtype">void</span> Line(<span class="keywordtype">int</span> startX, <span class="keywordtype">int</span> startY, <span class="keywordtype">int</span> endX, <span class="keywordtype">int</span> endY, D3DCOLOR color);
<a name="l00157"></a>00157                                 <span class="comment">//Line-drawing (Bresenham)</span>
<a name="l00158"></a>00158     <span class="keywordtype">void</span> HLine(<span class="keywordtype">int</span> startX, <span class="keywordtype">int</span> endX, <span class="keywordtype">int</span> y, D3DCOLOR color);
<a name="l00159"></a>00159                                 <span class="comment">//Fast horizontal line drawing</span>
<a name="l00160"></a>00160     <span class="keywordtype">void</span> HLineGradient(<span class="keywordtype">int</span> startX, <span class="keywordtype">int</span> endX, <span class="keywordtype">int</span> y, D3DCOLOR c1, D3DCOLOR c2);
<a name="l00161"></a>00161                                 <span class="comment">//Draws a horizontal line with a coursed color gradient</span>
<a name="l00162"></a>00162     <span class="keywordtype">void</span> Circle(<span class="keywordtype">int</span> posX, <span class="keywordtype">int</span> posY, <span class="keywordtype">int</span> radius, D3DCOLOR color);
<a name="l00163"></a>00163                                 <span class="comment">//Circle drawing (Bresenham)</span>
<a name="l00164"></a>00164     <span class="keywordtype">void</span> Rectangle(<span class="keywordtype">int</span> left, <span class="keywordtype">int</span> top, <span class="keywordtype">int</span> right, <span class="keywordtype">int</span> bottom, D3DCOLOR color);
<a name="l00165"></a>00165                                 <span class="comment">//Draws a filled rectangle</span>
<a name="l00166"></a>00166     <span class="keywordtype">void</span> RectangleGradient(<span class="keywordtype">int</span> left, <span class="keywordtype">int</span> top, <span class="keywordtype">int</span> right, <span class="keywordtype">int</span> bottom, 
<a name="l00167"></a>00167                            D3DCOLOR ul, D3DCOLOR ur, D3DCOLOR ll, D3DCOLOR lr);
<a name="l00168"></a>00168                                 <span class="comment">//Draws a filled rectangle with color gradient</span>
<a name="l00169"></a>00169     <span class="keywordtype">int</span>  GetScreenWidth();
<a name="l00170"></a>00170     <span class="keywordtype">int</span>  GetScreenHeight();
<a name="l00171"></a>00171     <span class="keywordtype">bool</span> IsScreenFullscreen();
<a name="l00172"></a>00172   };
<a name="l00173"></a>00173 
<a name="l00174"></a>00174 
<a name="l00175"></a>00175   <span class="keyword">class </span>gb2DSprite: <span class="keyword">public</span> gb2DInterface {
<a name="l00176"></a>00176       <span class="comment">//todo: integrate this with the manager</span>
<a name="l00177"></a>00177   <span class="keyword">friend</span> gb2DImageLoader; <span class="keyword">friend</span> gb2DManager;
<a name="l00178"></a>00178   <span class="keyword">public</span>:
<a name="l00179"></a>00179       <span class="keyword">enum</span> {
<a name="l00180"></a>00180           BLEND_DEACTIVATED,    <span class="comment">//use no blending at all</span>
<a name="l00181"></a>00181           BLEND_USEKEY,         <span class="comment">//use the specified color-key (only one color key can be active at a time)</span>
<a name="l00182"></a>00182           BLEND_USEALPHA        <span class="comment">//use the image's alpha values for blending</span>
<a name="l00183"></a>00183       } blendingMode;                   <span class="comment">//Blending mode - this is public so it can be set directly</span>
<a name="l00184"></a>00184   <span class="keyword">private</span>:
<a name="l00185"></a>00185       DWORD alphaKey;                   <span class="comment">//used for color-keyed blending if blendingMode is set to BLEND_USEKEY</span>
<a name="l00186"></a>00186       DWORD* data;                      <span class="comment">//pointer to the sprite's data</span>
<a name="l00187"></a>00187       <span class="keywordtype">short</span> width, height;              <span class="comment">//specifies the sprites dimensions</span>
<a name="l00188"></a>00188       <span class="keywordtype">int</span> posX;                         <span class="comment">//the sprite's position in screen-coordinates</span>
<a name="l00189"></a>00189       <span class="keywordtype">int</span> posY;                         <span class="comment">//the sprite's position in screen-coordinates</span>
<a name="l00190"></a>00190       <span class="keywordtype">double</span> angle;                     <span class="comment">//Rotation angle</span>
<a name="l00191"></a>00191   <span class="keyword">public</span>:
<a name="l00192"></a>00192       gb2DSprite(<span class="keywordtype">short</span> Width, <span class="keywordtype">short</span> Height);
<a name="l00193"></a>00193       ~gb2DSprite();
<a name="l00194"></a>00194       GB2DERROR GetErrorState();
<a name="l00195"></a>00195       <span class="keywordtype">void</span> StoreImageData(DWORD* pData);<span class="comment">//fill the data structure; pData must be at least width*height!</span>
<a name="l00196"></a>00196       <span class="keywordtype">void</span> SetPosition(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y);   <span class="comment">//specify position of the sprite in screen coordinates</span>
<a name="l00197"></a>00197       <span class="keywordtype">void</span> SetColorKey(D3DCOLOR key);   <span class="comment">//set a color key and activate color-keyed-blending</span>
<a name="l00198"></a>00198       <span class="keywordtype">void</span> SetRotation(<span class="keywordtype">double</span> angle);   <span class="comment">//set the rotation angle</span>
<a name="l00199"></a>00199       <span class="keywordtype">double</span> GetRotation();             <span class="comment">//return the current angle</span>
<a name="l00200"></a>00200       <span class="keywordtype">void</span> ApplyColorKey(D3DCOLOR key); <span class="comment">//Apply a color key to the image data itself and activate alpha-blending (required for multiple color keys)</span>
<a name="l00201"></a>00201       D3DCOLOR GetColorKey();           <span class="comment">//returns the most recently set color key</span>
<a name="l00202"></a>00202   };
<a name="l00203"></a>00203 
<a name="l00204"></a>00204 
<a name="l00205"></a>00205   <span class="keyword">class </span>gb2DImageLoader: <span class="keyword">public</span> gb2DInterface {
<a name="l00206"></a>00206   <span class="keyword">public</span>:
<a name="l00207"></a>00207       <span class="keyword">enum</span> GB2D_IMAGETYPE {
<a name="l00208"></a>00208           NONE, TGA, BMP, RAW, PCX, PNG, PPM, TIFF <span class="comment">/*todo: autodetect*/</span>
<a name="l00209"></a>00209       };
<a name="l00210"></a>00210   <span class="keyword">private</span>:
<a name="l00211"></a>00211       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* data;      <span class="comment">//pointer to image data</span>
<a name="l00212"></a>00212       D3DCOLOR* palette;        <span class="comment">//pointer to color palette</span>
<a name="l00213"></a>00213       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> file_offset; <span class="comment">//offset of file pointer (if multiple images are stored in the same file)</span>
<a name="l00214"></a>00214       <span class="keywordtype">int</span> width;
<a name="l00215"></a>00215       <span class="keywordtype">int</span> height;
<a name="l00216"></a>00216       <span class="keywordtype">int</span> bpp;
<a name="l00217"></a>00217       <span class="keywordtype">bool</span> data_is_valid;       <span class="comment">//flag for internal use; indicates whether the other member variables are sane</span>
<a name="l00218"></a>00218       GB2D_IMAGETYPE type;
<a name="l00219"></a>00219   <span class="keyword">public</span>:
<a name="l00220"></a>00220       gb2DImageLoader(<span class="keyword">const</span> <span class="keywordtype">char</span>* fname, GB2D_IMAGETYPE img_type);
<a name="l00221"></a>00221       gb2DImageLoader();
<a name="l00222"></a>00222       ~gb2DImageLoader();
<a name="l00223"></a>00223       GB2DERROR GetErrorState();    <span class="comment">//Return the current errorstate</span>
<a name="l00224"></a>00224       <span class="keywordtype">void</span> LoadFile(<span class="keyword">const</span> <span class="keywordtype">char</span>* fname, GB2D_IMAGETYPE img_type);
<a name="l00225"></a>00225                                     <span class="comment">//clears existing image data and reads a new file</span>
<a name="l00226"></a>00226       <span class="keywordtype">int</span> GetWidth();
<a name="l00227"></a>00227       <span class="keywordtype">int</span> GetHeight();
<a name="l00228"></a>00228       <span class="keywordtype">int</span> GetBpp();
<a name="l00229"></a>00229       <span class="keywordtype">void</span> GetImageData(DWORD* pData);
<a name="l00230"></a>00230                                     <span class="comment">//copy image data to pData (pData must be at least width*height*4 bytes!)</span>
<a name="l00231"></a>00231       <span class="keywordtype">void</span> GetRawData(DWORD* pRaw); <span class="comment">//copy raw image data (pRaw must be at least width*height*4 bytes!)</span>
<a name="l00232"></a>00232       <span class="keywordtype">void</span> GetPaletteData(DWORD* pPal);
<a name="l00233"></a>00233                                     <span class="comment">//copy palette data (pPal must be at least 2^Bpp bytes)</span>
<a name="l00234"></a>00234       LPGBSPRITE CreateSprite();    <span class="comment">//Build a new sprite object and copy image data</span>
<a name="l00235"></a>00235   };
<a name="l00236"></a>00236 
<a name="l00237"></a>00237 
<a name="l00238"></a>00238   <span class="keyword">class </span>gb2DFont: <span class="keyword">public</span> gb2DInterface {
<a name="l00239"></a>00239     <span class="keyword">friend</span> gb2DFontList;
<a name="l00240"></a>00240   <span class="keyword">private</span>:
<a name="l00241"></a>00241       LPD3DXFONT lpFont;                <span class="comment">//Font-object</span>
<a name="l00242"></a>00242       LPD3DXSPRITE lpBuffer;            <span class="comment">//pointer to gb2DManager's buffer-sprite</span>
<a name="l00243"></a>00243       <span class="keywordtype">wchar_t</span>* cBuffer;                 <span class="comment">//character-buffer</span>
<a name="l00244"></a>00244       <span class="keywordtype">int</span> iBufferSize;                  <span class="comment">//size of cBuffer in characters</span>
<a name="l00245"></a>00245       <span class="keywordtype">int</span> iBufferOffset;                <span class="comment">//currently occupied characters in buffer</span>
<a name="l00246"></a>00246       RECT rct;                         <span class="comment">//rct structure determining position and size of text-field</span>
<a name="l00247"></a>00247       D3DCOLOR color;                   <span class="comment">//text-color</span>
<a name="l00248"></a>00248       HRESULT hres;                     <span class="comment">//global result handle, may be used for additional debugging</span>
<a name="l00249"></a>00249       <span class="keywordtype">void</span> Render();                    <span class="comment">//Render()-method calles by gb2DFontList (implicitly clears buffer)</span>
<a name="l00250"></a>00250   <span class="keyword">public</span>:
<a name="l00251"></a>00251       gb2DFont(LPDIRECT3DDEVICE9 lpDev, LPD3DXSPRITE lpSpriteBuffer, <span class="keywordtype">int</span> fontSize, <span class="keywordtype">int</span> fontBold, <span class="keywordtype">int</span> fontItalic, <span class="keyword">const</span> <span class="keywordtype">wchar_t</span>* fontName);
<a name="l00252"></a>00252       ~gb2DFont();
<a name="l00253"></a>00253       GB2DERROR GetErrorState();
<a name="l00254"></a>00254       <span class="keywordtype">void</span> SetPosition(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y);
<a name="l00255"></a>00255       <span class="keywordtype">void</span> SetColor(D3DCOLOR d3dColor);
<a name="l00256"></a>00256       <span class="keywordtype">void</span> SetSize(<span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height);
<a name="l00257"></a>00257       <span class="keywordtype">void</span> ClrScr();                    <span class="comment">//explicit buffer clear</span>
<a name="l00258"></a>00258       <span class="keywordtype">void</span> print(<span class="keyword">const</span> <span class="keywordtype">wchar_t</span>* str, ...);
<a name="l00259"></a>00259                                         <span class="comment">//append characters to buffer</span>
<a name="l00260"></a>00260   };
<a name="l00261"></a>00261 
<a name="l00262"></a>00262 
<a name="l00263"></a>00263 <span class="preprocessor">#  ifdef GB2D__USE_GBTEXT</span>
<a name="l00264"></a>00264 <span class="preprocessor"></span>      <span class="keyword">class </span>gb2DText: <span class="keyword">public</span> gb2DInterface {
<a name="l00265"></a>00265                                             <span class="comment">//renders text on D3DTextures</span>
<a name="l00266"></a>00266           <span class="keyword">friend</span> gb2DManager;
<a name="l00267"></a>00267       <span class="keyword">private</span>:
<a name="l00268"></a>00268           <span class="keywordtype">int</span>       res_x;                  <span class="comment">//texture resolution</span>
<a name="l00269"></a>00269           <span class="keywordtype">int</span>       res_y;                  <span class="comment">//texture resolution</span>
<a name="l00270"></a>00270           <span class="keywordtype">wchar_t</span>*  cbuffer;                <span class="comment">//character buffer</span>
<a name="l00271"></a>00271           <span class="keywordtype">int</span>       cursor_pos_x;           <span class="comment">//cursor position</span>
<a name="l00272"></a>00272           <span class="keywordtype">int</span>       cursor_pos_y;           <span class="comment">//cursor position</span>
<a name="l00273"></a>00273           <span class="keywordtype">int</span>       rows;                   <span class="comment">//number of character rows</span>
<a name="l00274"></a>00274           <span class="keywordtype">int</span>       chars_per_row;          <span class="comment">//number of character columns</span>
<a name="l00275"></a>00275           <span class="keywordtype">int</span>       font_size_x;            <span class="comment">//font width</span>
<a name="l00276"></a>00276           <span class="keywordtype">int</span>       font_size_y;            <span class="comment">//font height</span>
<a name="l00277"></a>00277           D3DCOLOR* colorbuffer;            <span class="comment">//buffer for color values</span>
<a name="l00278"></a>00278           D3DCOLOR  color;                  <span class="comment">//cursor color</span>
<a name="l00279"></a>00279           D3DCOLOR  bgcolor;                <span class="comment">//buffer background color</span>
<a name="l00280"></a>00280           D3DCOLOR  fontbgcolor;            <span class="comment">//cursor background color</span>
<a name="l00281"></a>00281           LPDIRECT3DTEXTURE9 texture;       <span class="comment">//texture that is rendered on</span>
<a name="l00282"></a>00282           <span class="keywordtype">void</span>*     sprite;                 <span class="comment">//reserved pointer (used by gb2DManager)</span>
<a name="l00283"></a>00283           <span class="keywordtype">void</span> RenderSingleChar(<span class="keywordtype">wchar_t</span> <span class="keyword">const</span>&amp; c, <span class="keywordtype">int</span> <span class="keyword">const</span>&amp; x, <span class="keywordtype">int</span> <span class="keyword">const</span>&amp; y, D3DCOLOR <span class="keyword">const</span>&amp; color, D3DLOCKED_RECT <span class="keyword">const</span>&amp; target);
<a name="l00284"></a>00284                                             <span class="comment">//helper function: renders a single character</span>
<a name="l00285"></a>00285           <span class="keywordtype">void</span> FillSingleChar(<span class="keywordtype">int</span> <span class="keyword">const</span>&amp; x, <span class="keywordtype">int</span> <span class="keyword">const</span>&amp; y, D3DLOCKED_RECT <span class="keyword">const</span>&amp; target);
<a name="l00286"></a>00286                                             <span class="comment">//helper function: fill a character-field with bgcolor</span>
<a name="l00287"></a>00287       <span class="keyword">public</span>:
<a name="l00288"></a>00288           gb2DText(<span class="keywordtype">int</span> resolution_x, <span class="keywordtype">int</span> resolution_y, LPDIRECT3DTEXTURE9 lpTex);
<a name="l00289"></a>00289           ~gb2DText();
<a name="l00290"></a>00290           <span class="keywordtype">void</span> SetColor(D3DCOLOR d3dcolor); <span class="comment">//changes cursor color (print()-time)</span>
<a name="l00291"></a>00291           <span class="keywordtype">void</span> SetBGColor(D3DCOLOR d3dcolor);
<a name="l00292"></a>00292                                             <span class="comment">//changes background color (render()-time)</span>
<a name="l00293"></a>00293           <span class="keywordtype">void</span> SetFontBGColor(D3DCOLOR d3dcolor);
<a name="l00294"></a>00294                                             <span class="comment">//changes font background color (render()-time)</span>
<a name="l00295"></a>00295           <span class="keywordtype">void</span> SetPosition(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y);   <span class="comment">//changes cursor position</span>
<a name="l00296"></a>00296           <span class="keywordtype">int</span> GetPositionX() <span class="keyword">const</span>;         <span class="comment">//get current cursor position in X</span>
<a name="l00297"></a>00297           <span class="keywordtype">int</span> GetPositionY() <span class="keyword">const</span>;         <span class="comment">//get current cursor position in Y</span>
<a name="l00298"></a>00298           <span class="keywordtype">void</span> ClrScr();                    <span class="comment">//clears char and colorbuffer; resets cursor</span>
<a name="l00299"></a>00299           <span class="keywordtype">void</span> print(<span class="keyword">const</span> <span class="keywordtype">wchar_t</span>* str, ...);
<a name="l00300"></a>00300                                             <span class="comment">//write text to the buffer</span>
<a name="l00301"></a>00301           <span class="keywordtype">void</span> Render();                    <span class="comment">//render texture</span>
<a name="l00302"></a>00302           <span class="keywordtype">void</span> RenderExternalBuffer(<span class="keywordtype">wchar_t</span>* ext_buffer, D3DCOLOR* ext_color, <span class="keywordtype">int</span> size);
<a name="l00303"></a>00303                                             <span class="comment">//render texture based on external data</span>
<a name="l00304"></a>00304           <span class="keywordtype">void</span> DrawWindow(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height);
<a name="l00305"></a>00305           GB2DERROR GetErrorState();
<a name="l00306"></a>00306       };
<a name="l00307"></a>00307 <span class="preprocessor">#  endif</span>
<a name="l00308"></a>00308 <span class="preprocessor"></span>
<a name="l00309"></a>00309 <span class="preprocessor">#  ifdef GB2D__USE_GBUI</span>
<a name="l00310"></a>00310 <span class="preprocessor"></span><span class="preprocessor">#     include "../src/gbUI/gbUI.hpp"</span>
<a name="l00311"></a>00311 
<a name="l00312"></a>00312       <span class="keyword">class </span>gbUIManager: <span class="keyword">public</span> gb2DInterface {
<a name="l00313"></a>00313       <span class="keyword">private</span>:
<a name="l00314"></a>00314           LPDIRECT3DDEVICE9        lpDev;               <span class="comment">//D3D device</span>
<a name="l00315"></a>00315           HWND                     hWnd;
<a name="l00316"></a>00316           <span class="keyword">struct </span>{
<a name="l00317"></a>00317               <span class="keywordtype">int</span> pos_x, pos_y;
<a name="l00318"></a>00318               <span class="keywordtype">bool</span> lbutton, rbutton, mbutton;
<a name="l00319"></a>00319               <span class="keywordtype">int</span> ldownx, ldowny;
<a name="l00320"></a>00320               <span class="keywordtype">int</span> lupx, lupy;
<a name="l00321"></a>00321           } mouse;
<a name="l00322"></a>00322           LPGBUIFRAME root;
<a name="l00323"></a>00323           LPGBUIFRAME ldrag_src;
<a name="l00324"></a>00324           LPGBUIFRAME ldrag_dst;
<a name="l00325"></a>00325           <span class="keywordtype">void</span> MouseMoved();
<a name="l00326"></a>00326           <span class="keywordtype">void</span> LMouseDown();
<a name="l00327"></a>00327           <span class="keywordtype">void</span> LMouseUp();
<a name="l00328"></a>00328           <span class="keywordtype">void</span> KeyPressed();
<a name="l00329"></a>00329       <span class="keyword">public</span>:
<a name="l00330"></a>00330           gbUIManager(LPDIRECT3DDEVICE9 device, gb2DManager* gb2D, HWND hwnd);
<a name="l00331"></a>00331           ~gbUIManager();
<a name="l00332"></a>00332           LRESULT MessageCallback(HWND hWnd, UINT uMsg, WPARAM wParam, LPARAM lParam);
<a name="l00333"></a>00333           <span class="keywordtype">void</span> Render();
<a name="l00334"></a>00334           GB2DERROR GetErrorState();
<a name="l00335"></a>00335           LPGBUIFRAME GetRootFrame();
<a name="l00336"></a>00336           <span class="keywordtype">int</span> GetMouseX();
<a name="l00337"></a>00337           <span class="keywordtype">int</span> GetMouseY();
<a name="l00338"></a>00338       };
<a name="l00339"></a>00339 <span class="preprocessor">#  endif</span>
<a name="l00340"></a>00340 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Sat Jan 19 18:58:21 2008 for PS2 IconSys Library by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.4 </small></address>
</body>
</html>
